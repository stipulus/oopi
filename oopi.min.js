var oopi={classMap:{},map:{},defineClass:function(a,b){function c(){}if("undefiend"==typeof a||a.length<1)throw new Exception("Class must have a name");if("undefiend"==typeof b)throw new Exception("Class "+a+" cannot be null");if("undefined"!=typeof b.extend)throw new Exception("Illegal attempt to overide extend method in "+a);if("undefined"!=typeof b.create)throw new Exception("Illegal attempt to overide create method in "+a);c.prototype=this.parseMethods(b),this.classMap[a]=new c,this.map[a]=new Array,this.assignDefaultMethods(a),window[a]=this.classMap[a]},parseMethods:function(a){for(var b in a)if("function"==typeof a[b]){for(var c=a[b].toString(),d=c.search("{"),e=d+1,f=1;f>0;e++){if("'"==c.charAt(e))for(e+=1;"'"!=c.charAt(e);e++);if('"'==c.charAt(e))for(e+=1;'"'!=c.charAt(e);e++);"{"==c.charAt(e)?f++:"}"==c.charAt(e)?f--:"s"==c.charAt(e)&&"i"==c.charAt(e-1)&&"h"==c.charAt(e-2)&&"t"==c.charAt(e-3)&&(c=c.substr(0,e-3)+"oopi.map[this.oopi_className][this.oopi_id]"+c.substr(e+1),e+=41)}a[b]=new Function(c.substr(d+1,c.lastIndexOf("}")-d-1))}return a},assignDefaultMethods:function(a){this.classMap[a].oopi_id="",this.classMap[a].oopi_className=a,this.classMap[a].create=function(){var b=oopi.classMap[a].oopi_className,c=oopi.newobj(b);for(var d in oopi.classMap[b])if("create"===d||"extend"===d||"free"===d);else if("function"==typeof oopi.classMap[b][d])oopi.assignMethod(b,d,c);else{var e=oopi.classMap[a][d];oopi.map[b][c][d]=e}return"function"==typeof oopi.map[b][c].construct&&oopi.map[b][c].construct(),oopi.map[b][c]},this.classMap[a].extend=function(b,c){oopi.extend(b,a,c)},this.classMap[a].free=function(){this.free=!0}},assignMethod:function(a,b,c){this.map[a][c][b]=function(){var d=oopi.classMap[a].oopi_id;oopi.classMap[a].oopi_id=c;var e=oopi.classMap[a][b](arguments);return oopi.classMap[a].oopi_id=d,e}},extend:function(a,b,c){this.defineClass(a,c);var d;this.classMap[a].superClass={};for(var e in this.classMap[b])if("construct"!=e){d=!1;for(var f in this.classMap[a])if(e==f){d=!0;break}var g=this.classMap[b][e];d?this.classMap[a].superClass[e]=g:this.classMap[a][e]=g}},defineAbstract:function(){},defineInterface:function(){},free:function(a){a.oopi_free=!0},newobj:function(a){function c(){}for(var b=0;b<oopi.map[a].length&&!oopi.map[a][b].oopi_free;b++);return b===oopi.map[a].length&&(oopi.map[a][b]=new c,oopi.map[a][b].oopi_id=b),b}};window.oopi=oopi;